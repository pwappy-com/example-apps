const omikuji_stick_map={1:"omikuji_stick_daikichi",2:"omikuji_stick_cyuukichi",3:"omikuji_stick_syoukichi",4:"omikuji_stick_kichi",5:"omikuji_stick_kyou",6:"omikuji_stick_daikyou",}
const rin=new Audio('./sounds/rin.mp3?v=2');rin.preload='auto';let stickOut=!1;let stickOutNumber=0;async function load(event){if(window.DeviceMotionEvent){let prevX=null;let prevY=null;let prevZ=null;let shakeCount=0;const shakeThreshold=5;const windowSize=5;const shakeWindow=500;const resultElement=document.getElementById('result');let accelerationBufferX=[];let accelerationBufferY=[];let accelerationBufferZ=[];let lastShakeTime=0;window.addEventListener('devicemotion',function(event){const acceleration=event.accelerationIncludingGravity;const x=acceleration.x;const y=acceleration.y;const z=acceleration.z;const currentTime=new Date().getTime();accelerationBufferX.push(x);accelerationBufferY.push(y);accelerationBufferZ.push(z);if(accelerationBufferX.length>windowSize){accelerationBufferX.shift();accelerationBufferY.shift();accelerationBufferZ.shift()}
const avgX=accelerationBufferX.reduce((a,b)=>a+b,0)/accelerationBufferX.length;const avgY=accelerationBufferY.reduce((a,b)=>a+b,0)/accelerationBufferY.length;const avgZ=accelerationBufferZ.reduce((a,b)=>a+b,0)/accelerationBufferZ.length;if(prevX!==null&&prevY!==null&&prevZ!==null){const deltaX=Math.abs(avgX-prevX);const deltaY=Math.abs(avgY-prevY);const deltaZ=Math.abs(avgZ-prevZ);if(deltaX>shakeThreshold||deltaY>shakeThreshold||deltaZ>shakeThreshold){if(currentTime-lastShakeTime>shakeWindow){shakeCount++;lastShakeTime=currentTime;if(avgY<-5){if(!stickOut){rin.currentTime=0;rin.play();const randomKey=Object.keys(omikuji_stick_map)[Math.floor(Math.random()*Object.keys(omikuji_stick_map).length)];const omikujiStick=document.getElementById(omikuji_stick_map[randomKey]);omikujiStick.style.transition='transform 0.2s ease-in-out';omikujiStick.style.transform='translateY(0px)';stickOut=!0;stickOutNumber=randomKey;if(navigator.vibrate){navigator.vibrate(200)}}}else{if(stickOut){const omikujiStick=document.getElementById(omikuji_stick_map[stickOutNumber]);omikujiStick.style.transition='transform 0.2s ease-in-out';omikujiStick.style.transform='translateY(300px)';stickOut=!1;stickOutNumber=0}}}}else{}}
prevX=avgX;prevY=avgY;prevZ=avgZ})}else{alert('このブラウザはDeviceMotion APIをサポートしていません。')}}
window.addEventListener('load',load)